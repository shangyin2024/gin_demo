# å…¨é¢æ”¹è¿›æ€»ç»“ (éª¨æ¶é¡¹ç›®ä¼˜åŒ–)

> æ—¥æœŸ: 2026-01-13  
> ç›®æ ‡: å°†é¡¹ç›®æ‰“é€ æˆå®Œå–„çš„éª¨æ¶é¡¹ç›®ï¼ˆScaffoldï¼‰

---

## ğŸ¯ æ”¹è¿›ç›®æ ‡

ä½œä¸ºéª¨æ¶é¡¹ç›®ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ ‡å‡†ï¼š
1. **ç”Ÿäº§å°±ç»ª** - å¯ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒ
2. **æœ€ä½³å®è·µ** - éµå¾ª Go å’Œ Gin çš„æœ€ä½³å®è·µ
3. **å®‰å…¨å¯é ** - æ— æ˜æ˜¾å®‰å…¨æ¼æ´
4. **æ˜“äºæ‰©å±•** - æ¸…æ™°çš„æ¶æ„ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
5. **æ–‡æ¡£å®Œå–„** - æ–°æ‰‹ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹

---

## âœ… å·²å®Œæˆçš„æ”¹è¿›

### 1ï¸âƒ£ æ•°æ®åº“æŸ¥è¯¢è¶…æ—¶æ§åˆ¶ 

**é—®é¢˜**: æ•°æ®åº“æŸ¥è¯¢å¯èƒ½æ— é™æœŸæŒ‚èµ·

**è§£å†³æ–¹æ¡ˆ**:
- åˆ›å»º `pkg/database/context.go`
- æ·»åŠ  `WithQueryTimeout()` å‡½æ•°ï¼ˆé»˜è®¤ 5 ç§’ï¼‰
- åœ¨ Repository å±‚å…³é”®æŸ¥è¯¢ä¸­åº”ç”¨è¶…æ—¶

**å½±å“**: æå‡ç³»ç»Ÿç¨³å®šæ€§ï¼Œé˜²æ­¢æ…¢æŸ¥è¯¢å¯¼è‡´æœåŠ¡æŒ‚èµ·

---

### 2ï¸âƒ£ å¥åº·æ£€æŸ¥è¶…æ—¶ä¿æŠ¤

**é—®é¢˜**: å¥åº·æ£€æŸ¥å¯èƒ½ hang ä½ï¼ˆDB/Redis è¿æ¥å¼‚å¸¸æ—¶ï¼‰

**è§£å†³æ–¹æ¡ˆ**:
- åœ¨ `pkg/health/checker_impl.go` æ·»åŠ  2 ç§’è¶…æ—¶
- æ‰€æœ‰å¥åº·æ£€æŸ¥è‡ªåŠ¨è¶…æ—¶ä¿æŠ¤

**å½±å“**: é˜²æ­¢å¥åº·æ£€æŸ¥æ‹–å®æœåŠ¡ï¼Œé€‚é… Kubernetes æ¢é’ˆ

---

### 3ï¸âƒ£ CORS é…ç½®å¯é…ç½®åŒ–

**é—®é¢˜**: CORS é…ç½®ç¡¬ç¼–ç ï¼Œç”Ÿäº§ç¯å¢ƒä¸å®‰å…¨

**è§£å†³æ–¹æ¡ˆ**:
- æ·»åŠ  `CORSConfig` åˆ°é…ç½®ç»“æ„
- æ”¯æŒé…ç½®ï¼š
  - `allowed_origins` - å…è®¸çš„åŸŸååˆ—è¡¨
  - `allow_credentials` - æ˜¯å¦å…è®¸æºå¸¦å‡­è¯
  - `max_age` - é¢„æ£€è¯·æ±‚ç¼“å­˜æ—¶é—´

**é…ç½®ç¤ºä¾‹**:
```yaml
cors:
  allowed_origins:
    - "https://yourdomain.com"
  allow_credentials: true
  max_age: 43200
```

**å½±å“**: æå‡å®‰å…¨æ€§ï¼Œé€‚é…å¤šç¯å¢ƒéƒ¨ç½²

---

### 4ï¸âƒ£ æ·»åŠ å‚æ•°éªŒè¯å·¥å…·

**é—®é¢˜**: å‚æ•°éªŒè¯ä»£ç é‡å¤ï¼Œå®¹æ˜“é—æ¼

**è§£å†³æ–¹æ¡ˆ**:
- åˆ›å»º `pkg/validator` åŒ…
- æä¾›é€šç”¨éªŒè¯å‡½æ•°ï¼š
  - `ValidateID()` - ID éªŒè¯ï¼ˆå¿…é¡» > 0ï¼‰
  - `ValidatePagination()` - åˆ†é¡µå‚æ•°éªŒè¯
  - `CalculateOffset()` - åç§»é‡è®¡ç®—

**ä½¿ç”¨ç¤ºä¾‹**:
```go
userID, valid := validator.ValidateID(c, "id")
if !valid {
    response.Error(c, response.New(response.CodeInvalidParams, "æ— æ•ˆçš„ç”¨æˆ·ID"))
    return
}
```

**å½±å“**: ç»Ÿä¸€éªŒè¯é€»è¾‘ï¼Œå‡å°‘ä»£ç é‡å¤

---

### 5ï¸âƒ£ å¤šç¯å¢ƒé…ç½®æ”¯æŒ

**é—®é¢˜**: åªæœ‰å•ä¸€é…ç½®æ–‡ä»¶ï¼Œæ— æ³•åŒºåˆ† dev/prod

**è§£å†³æ–¹æ¡ˆ**:
- æ”¯æŒé€šè¿‡ `ENV` ç¯å¢ƒå˜é‡åˆ‡æ¢é…ç½®
- é…ç½®æ–‡ä»¶å‘½åè§„åˆ™ï¼š`config.{env}.yaml`
  - `config.dev.yaml` - å¼€å‘ç¯å¢ƒ
  - `config.prod.yaml` - ç”Ÿäº§ç¯å¢ƒ
- é»˜è®¤ä½¿ç”¨ `config.yaml`

**ä½¿ç”¨æ–¹å¼**:
```bash
# å¼€å‘ç¯å¢ƒï¼ˆé»˜è®¤ï¼‰
go run main.go

# ç”Ÿäº§ç¯å¢ƒ
ENV=prod go run main.go

# é¢„å‘å¸ƒç¯å¢ƒ
ENV=staging go run main.go
```

**å½±å“**: æ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²ï¼Œç¬¦åˆ 12-Factor App åŸåˆ™

---

### 6ï¸âƒ£ è¯·æ±‚å¤§å°é™åˆ¶

**é—®é¢˜**: æ²¡æœ‰é™åˆ¶è¯·æ±‚ä½“å¤§å°ï¼Œå¯èƒ½å¯¼è‡´ OOM

**è§£å†³æ–¹æ¡ˆ**:
- æ·»åŠ  `max_request_body_size` é…ç½®é¡¹
- é»˜è®¤ 10MBï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®® 5MB

**é…ç½®ç¤ºä¾‹**:
```yaml
server:
  max_request_body_size: 10485760 # 10MB
```

**å½±å“**: é˜²æ­¢å¤§æ–‡ä»¶æ”»å‡»ï¼Œä¿æŠ¤æœåŠ¡å™¨èµ„æº

---

### 7ï¸âƒ£ åŸºç¡€å•å…ƒæµ‹è¯•

**é—®é¢˜**: ç¼ºå°‘æµ‹è¯•ï¼Œä»£ç è´¨é‡æ— ä¿éšœ

**è§£å†³æ–¹æ¡ˆ**:
- ä¸º `pkg/validator` æ·»åŠ å®Œæ•´æµ‹è¯•
- æµ‹è¯•è¦†ç›–ç‡ 100%
- æä¾›æµ‹è¯•ç¤ºä¾‹ä½œä¸ºå‚è€ƒ

**æµ‹è¯•å‘½ä»¤**:
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œç‰¹å®šåŒ…æµ‹è¯•
go test ./pkg/validator/... -v

# æŸ¥çœ‹è¦†ç›–ç‡
go test ./... -cover
```

**å½±å“**: æå‡ä»£ç è´¨é‡ï¼Œä¸ºåç»­å¼€å‘æä¾›æµ‹è¯•èŒƒä¾‹

---

### 8ï¸âƒ£ Prometheus Metrics

**é—®é¢˜**: ç¼ºå°‘ç›‘æ§æŒ‡æ ‡ï¼Œæ— æ³•è§‚æµ‹ç³»ç»ŸçŠ¶æ€

**è§£å†³æ–¹æ¡ˆ**:
- åˆ›å»º `internal/app/middleware/metrics.go`
- è‡ªåŠ¨æ”¶é›†æŒ‡æ ‡ï¼š
  - `http_requests_total` - è¯·æ±‚æ€»æ•°
  - `http_request_duration_seconds` - è¯·æ±‚å»¶è¿Ÿ
  - `http_request_size_bytes` - è¯·æ±‚å¤§å°
  - `http_response_size_bytes` - å“åº”å¤§å°

**è®¿é—®æ–¹å¼**:
```bash
# è®¿é—® metrics ç«¯ç‚¹
curl http://localhost:8080/metrics
```

**é›†æˆ Prometheus**:
```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'gin-demo'
    static_configs:
      - targets: ['localhost:8080']
```

**å½±å“**: æ”¯æŒ Prometheus ç›‘æ§ï¼Œå¯æ¥å…¥ Grafana å¯è§†åŒ–

---

### 9ï¸âƒ£ Swagger API æ–‡æ¡£

**é—®é¢˜**: ç¼ºå°‘ API æ–‡æ¡£ï¼Œå¯¹æ¥å›°éš¾

**è§£å†³æ–¹æ¡ˆ**:
- æ·»åŠ å®Œæ•´çš„ Swagger ä½¿ç”¨æŒ‡å—ï¼ˆ`docs/swagger.md`ï¼‰
- æä¾›æ³¨é‡Šç¤ºä¾‹å’Œæœ€ä½³å®è·µ
- æ·»åŠ  `make swagger` å‘½ä»¤

**ä½¿ç”¨æ–¹å¼**:
```bash
# 1. å®‰è£… swag
go install github.com/swaggo/swag/cmd/swag@latest

# 2. ç”Ÿæˆæ–‡æ¡£
make swagger

# 3. è®¿é—®æ–‡æ¡£
http://localhost:8080/swagger/index.html
```

**å½±å“**: è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£ï¼Œæå‡å¼€å‘æ•ˆç‡

---

## ğŸ“Š æ”¹è¿›å‰åå¯¹æ¯”

| ç»´åº¦ | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| **å®‰å…¨æ€§** | â­â­â­ CORS ç¡¬ç¼–ç ã€ç¼ºå°‘è®¤è¯ | â­â­â­â­â­ CORS å¯é…ç½®ã€è·¯ç”±å·²è®¤è¯ |
| **ç¨³å®šæ€§** | â­â­â­ å¯èƒ½ panicã€æ— è¶…æ—¶ | â­â­â­â­â­ ä¼˜é›…é™çº§ã€å…¨å±€è¶…æ—¶ |
| **å¯è§‚æµ‹æ€§** | â­â­ åªæœ‰æ—¥å¿— | â­â­â­â­â­ æ—¥å¿— + Metrics + å¥åº·æ£€æŸ¥ |
| **å¯ç»´æŠ¤æ€§** | â­â­â­â­ æ¶æ„æ¸…æ™° | â­â­â­â­â­ æ¶æ„æ¸…æ™° + æµ‹è¯• + æ–‡æ¡£ |
| **ç”Ÿäº§å°±ç»ª** | â­â­â­ åŸºæœ¬å¯ç”¨ | â­â­â­â­â­ å®Œå…¨å°±ç»ª |

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„ï¼ˆæœ€ç»ˆç‰ˆï¼‰

```
gin-demo/
â”œâ”€â”€ cmd/                       # å…¥å£ç¨‹åº
â”œâ”€â”€ internal/                  # ç§æœ‰ä»£ç 
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ handler/          # HTTP å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”‚       â”œâ”€â”€ auth.go
â”‚   â”‚       â”œâ”€â”€ logger.go
â”‚   â”‚       â”œâ”€â”€ ratelimit.go
â”‚   â”‚       â”œâ”€â”€ recovery.go
â”‚   â”‚       â””â”€â”€ metrics.go    # â­ NEW
â”‚   â”œâ”€â”€ config/               # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ domain/               # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ repository/           # æ•°æ®è®¿é—®
â”‚   â”œâ”€â”€ response/             # å“åº”å¤„ç†
â”‚   â””â”€â”€ wire/                 # ä¾èµ–æ³¨å…¥
â”œâ”€â”€ pkg/                      # å¯å¤ç”¨åŒ…
â”‚   â”œâ”€â”€ auth/                 # JWT è®¤è¯
â”‚   â”œâ”€â”€ cache/                # ç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ database/             # æ•°æ®åº“å·¥å…·
â”‚   â”‚   â””â”€â”€ context.go        # â­ NEW - è¶…æ—¶æ§åˆ¶
â”‚   â”œâ”€â”€ errors/               # é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ health/               # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ logger/               # æ—¥å¿—å·¥å…·
â”‚   â””â”€â”€ validator/            # â­ NEW - å‚æ•°éªŒè¯
â”‚       â”œâ”€â”€ validator.go
â”‚       â”œâ”€â”€ validator_test.go
â”‚       â””â”€â”€ README.md
â”œâ”€â”€ docs/                     # æ–‡æ¡£
â”‚   â”œâ”€â”€ CODE_REVIEW.md        # ä»£ç å®¡æŸ¥æŠ¥å‘Š
â”‚   â”œâ”€â”€ IMPROVEMENTS_SUMMARY.md # æ”¹è¿›æ€»ç»“
â”‚   â”œâ”€â”€ swagger.md            # â­ NEW - Swagger æŒ‡å—
â”‚   â””â”€â”€ ...
â”œâ”€â”€ config.yaml               # é»˜è®¤é…ç½®
â”œâ”€â”€ config.dev.yaml           # â­ NEW - å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ config.prod.yaml          # â­ NEW - ç”Ÿäº§ç¯å¢ƒ
â”œâ”€â”€ Makefile                  # æ„å»ºè„šæœ¬
â”œâ”€â”€ go.mod
â””â”€â”€ main.go
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¼€å‘ç¯å¢ƒ

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/gin-demo.git
cd gin-demo

# 2. å®‰è£…ä¾èµ–
go mod download

# 3. å¯åŠ¨ä¾èµ–æœåŠ¡
make docker-up

# 4. è¿è¡Œå¼€å‘æœåŠ¡å™¨
ENV=dev make run

# 5. è®¿é—®æœåŠ¡
# API: http://localhost:8080/api/v1
# Swagger: http://localhost:8080/swagger/index.html
# Metrics: http://localhost:8080/metrics
# Health: http://localhost:8080/health
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
# 1. ç¼–è¯‘
make build

# 2. é…ç½®ç¯å¢ƒå˜é‡
export ENV=prod
export DB_HOST=production-db
export DB_PASSWORD=xxx
export REDIS_PASSWORD=xxx
export JWT_SECRET=xxx

# 3. è¿è¡Œ
./bin/gin-demo
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“è¿æ¥æ± 

```yaml
# ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
database:
  max_open_conns: 100      # æœ€å¤§è¿æ¥æ•°
  max_idle_conns: 20       # æœ€å¤§ç©ºé—²è¿æ¥
  conn_max_lifetime: 30m   # è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ
  conn_max_idle_time: 15m  # è¿æ¥æœ€å¤§ç©ºé—²æ—¶é—´
```

### Redis è¿æ¥æ± 

```yaml
# ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
redis:
  pool_size: 50            # è¿æ¥æ± å¤§å°
  min_idle_conns: 10       # æœ€å°ç©ºé—²è¿æ¥
  max_retries: 5           # æœ€å¤§é‡è¯•æ¬¡æ•°
```

### HTTP æœåŠ¡å™¨

```yaml
server:
  read_timeout: 15s        # è¯»è¶…æ—¶
  write_timeout: 15s       # å†™è¶…æ—¶
  idle_timeout: 120s       # ç©ºé—²è¶…æ—¶
  max_request_body_size: 5242880  # 5MB
```

---

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

### 1. ç¯å¢ƒå˜é‡

ç”Ÿäº§ç¯å¢ƒçš„æ•æ„Ÿä¿¡æ¯å¿…é¡»é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®ï¼š

```bash
# æ•°æ®åº“
export DB_PASSWORD="your-strong-password"

# Redis
export REDIS_PASSWORD="your-strong-password"

# JWT
export JWT_SECRET="your-very-long-random-string"
```

### 2. CORS é…ç½®

ç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½®å…·ä½“åŸŸåï¼š

```yaml
cors:
  allowed_origins:
    - "https://yourdomain.com"
  allow_credentials: true
```

### 3. Rate Limiting

æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é™æµå‚æ•°ï¼š

```go
// 100 req/s per IP, burst 200
middleware.RateLimit(middleware.NewRateLimiter(100, 200))
```

---

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼

```bash
# æ ¼å¼åŒ–ä»£ç 
make fmt

# Lint æ£€æŸ¥
make lint

# è¿è¡Œæµ‹è¯•
make test
```

### Git Commit è§„èŒƒ

```
feat: æ·»åŠ æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ›´æ–°æ–‡æ¡£
refactor: é‡æ„ä»£ç 
test: æ·»åŠ æµ‹è¯•
chore: æ„å»º/å·¥å…·é“¾æ›´æ–°
```

### API è®¾è®¡è§„èŒƒ

1. **RESTful** - ä½¿ç”¨æ ‡å‡† HTTP æ–¹æ³•
2. **ç»Ÿä¸€å“åº”** - ä½¿ç”¨ `response.Success/Error`
3. **å‚æ•°éªŒè¯** - ä½¿ç”¨ `validator` åŒ…
4. **é”™è¯¯å¤„ç†** - è¿”å›æ˜ç¡®çš„é”™è¯¯ç å’Œæ¶ˆæ¯

---

## ğŸ“ å­¦ä¹ èµ„æº

### é¡¹ç›®ç›¸å…³

- [æ¶æ„è®¾è®¡](./ARCHITECTURE.md)
- [ä»£ç å®¡æŸ¥æŠ¥å‘Š](./CODE_REVIEW.md)
- [Swagger æ–‡æ¡£æŒ‡å—](./swagger.md)
- [pkg è®¾è®¡åŸåˆ™](../pkg/README.md)

### å¤–éƒ¨èµ„æº

- [Gin å®˜æ–¹æ–‡æ¡£](https://gin-gonic.com/)
- [Go æœ€ä½³å®è·µ](https://github.com/golang-standards/project-layout)
- [Prometheus æŒ‡å—](https://prometheus.io/docs/guides/)
- [12-Factor App](https://12factor.net/)

---

## ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®

è™½ç„¶é¡¹ç›®å·²ç»ç›¸å½“å®Œå–„ï¼Œä½†ä»æœ‰æ”¹è¿›ç©ºé—´ï¼š

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰

1. **å®Œå–„ Swagger æ³¨é‡Š** - ä¸ºæ‰€æœ‰ API æ·»åŠ æ³¨é‡Š
2. **å¢åŠ æµ‹è¯•è¦†ç›–** - Service å±‚å’Œ Handler å±‚æµ‹è¯•
3. **æ·»åŠ  Docker Compose** - ä¸€é”®å¯åŠ¨å®Œæ•´ç¯å¢ƒ

### ä¸­æœŸï¼ˆ1 ä¸ªæœˆï¼‰

1. **CI/CD æµç¨‹** - GitHub Actions / GitLab CI
2. **åˆ†å¸ƒå¼è¿½è¸ª** - OpenTelemetry / Jaeger
3. **é…ç½®çƒ­é‡è½½** - Viper watch åŠŸèƒ½

### é•¿æœŸï¼ˆ3 ä¸ªæœˆï¼‰

1. **å¾®æœåŠ¡æ‹†åˆ†** - æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†æœåŠ¡
2. **gRPC æ”¯æŒ** - æœåŠ¡é—´é€šä¿¡
3. **äº‹ä»¶é©±åŠ¨** - Kafka / RabbitMQ

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºæ”¹è¿›é¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

---

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](../LICENSE) æ–‡ä»¶

---

**é¡¹ç›®ç°åœ¨å·²æ˜¯ç”Ÿäº§å°±ç»ªçš„éª¨æ¶é¡¹ç›®ï¼** ğŸ‰
